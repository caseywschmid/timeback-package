{
  "post": {
    "operationId": "makeExternalTestAssignment",
    "summary": "Make external test assignment",
    "description": "\nMakes an external test assignment for the given student:\n- Applies to 'test-out', 'placement', and 'unit-test' lessons.\n\nThis logic changes depending on the provided \"toolProvider\" value:\n- For \"edulastic\":\n  - Authenticates the student with their email on Edulastic\n  - Assigns the test to the student in Edulastic\n  - Stores the received \"assignmentId\" and \"classId\" in the lesson's AssessmentResult\n  - Returns the test link, credentials, and IDs of the test for later results consumption\n- For \"mastery-track\":\n  - Authenticates the student with their email on MasteryTrack\n  - Assigns the test to the student in MasteryTrack (using the testId in the request or subject+grade from the lesson's Resource metadata)\n  - Stores the received \"assignmentId\" in the lesson's AssessmentResult\n  - Returns the test link, credentials, and IDs of the test\n  - Waits for a test result write-back to be performed by the MasteryTrack on test end\n\nWill fail if:\n- The lesson is not an external \"test-out\", \"placement\", or \"unit-test\", or the student does not exist\n- External tool (described in the resource.metadata.toolProvider) is not \"edulastic\" or \"mastery-track\"\n- Any other problem on the Edulastic or MasteryTrack API being used that may happen\n\nA 'Lesson' in this context is a ComponentResource object which has a Resource object with lessonType = \"test-out\", \"placement\", or \"unit-test\" associated with it.\n",
    "tags": ["PowerPath - Course Mastery"],
    "requestBody": {
      "content": {
        "application/json": {
          "schema": {
            "type": "object",
            "properties": {
              "student": {
                "type": "string",
                "description": "The sourcedId of the student"
              },
              "lesson": {
                "type": "string",
                "description": "The sourcedId of the lesson (ComponentResource)"
              },
              "applicationName": {
                "type": "string",
                "description": "The name of the application to use for authenticating on the external tool"
              },
              "testId": {
                "type": "string",
                "description": "The specific test ID to assign for MasteryTrack tool provider. If provided, overrides subject+grade selection."
              },
              "skipCourseEnrollment": {
                "type": "boolean",
                "description": "When true, skips automatic course enrollment after test completion. Only applies to the current attempt."
              }
            },
            "required": ["student", "lesson"]
          }
        }
      }
    },
    "responses": {
      "200": {
        "description": "Success",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "toolProvider": {
                  "type": "string",
                  "enum": ["edulastic", "mastery-track"]
                },
                "lessonType": {
                  "type": "string",
                  "enum": ["test-out", "placement", "unit-test"]
                },
                "attempt": {
                  "type": "number",
                  "description": "The attempt number"
                },
                "credentials": {
                  "type": "object",
                  "properties": {
                    "email": {
                      "type": "string",
                      "format": "email"
                    },
                    "password": {
                      "type": "string"
                    }
                  },
                  "required": ["email", "password"],
                  "description": "The credentials for accessing the assigned test on external tool"
                },
                "assignmentId": {
                  "type": "string",
                  "description": "The id of the assignment on external tool for results retrieval"
                },
                "classId": {
                  "type": "string",
                  "description": "The id of the class on external tool for results retrieval (may be empty for some tools)"
                },
                "testUrl": {
                  "type": "string",
                  "format": "uri",
                  "description": "The URL of the test on external tool"
                },
                "testId": {
                  "type": "string",
                  "description": "The id of the test on external tool (may be assignment ID for some tools)"
                }
              },
              "required": ["toolProvider", "lessonType", "attempt"]
            }
          }
        }
      },
      "400": {
        "description": "Bad Request",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/BadRequestResponse"
            }
          }
        }
      },
      "401": {
        "description": "Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/UnauthorizedRequestResponse"
            }
          }
        }
      },
      "403": {
        "description": "Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ForbiddenResponse"
            }
          }
        }
      },
      "404": {
        "description": "Not Found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/NotFoundResponse"
            }
          }
        }
      },
      "422": {
        "description": "Unprocessable Entity / Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/UnprocessableEntityResponse"
            }
          }
        }
      },
      "429": {
        "description": "Too Many Requests",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/TooManyRequestsResponse"
            }
          }
        }
      },
      "500": {
        "description": "Internal Server Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/InternalServerErrorResponse"
            }
          }
        }
      }
    }
  }
}
